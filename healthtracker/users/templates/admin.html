{% extends "layouts/layout.html" %}
{% from 'macros/admin_nav.html' import admin_nav with context %}
{% block body %}
<div class="container">
  {{ admin_nav("users") }}
  {% include "macros/flash.html" %}
  <div>
    <div class="users">
      <table class="table table-condensed">
        <tbody>
          {% for user in users %}
          <tr>
            <td>
              {% if user.is_confirmed %}
              <i class="icon-check"></i>
              {% else %}
              <i class="icon-remove"></i>
              {% endif %}
              <a href="/users/{{ user.id }}/edit?auth_token={{ auth_token }}">{{ user.email }}</a>
              {% if user.is_admin %}<span class="label label-info">admin</span>{% endif %}
            </td>

            <td>
              <tt><span title="{{ user.auth_token }}">{{ user.auth_token[10:] + '...' }}</span></tt>
              <a class="btn btn-warning btn-mini" 
                 data-action-url="{{ url_for('user.reset_auth', user_id=user.id, auth_token=auth_token) }}"
                 data-action-method="POST"
                 data-confirm="Are you sure you want to refresh this auth token?">
                <i class="icon-repeat icon-white"></i>
              </a>
            </td>

            <td>
              <a class="btn {{ 'btn-warning' if user.is_approved else 'btn-primary' }} btn-mini"
                 data-action-url="{{ url_for('user.toggle_approve', user_id=user.id, auth_token=auth_token) }}"
                 data-action-method="POST"
                 data-confirm="Are you sure you want to {{ 'unapprove' if user.is_approved else 'approve' }} {{ user.email }}?">
                {{ 'Unapprove' if user.is_approved else 'Approve' }}
              </a>

              <a class="btn btn-primary btn-mini"
                 data-action-url="{{ url_for('user.update_email', user_id=user.id, auth_token=auth_token) }}"
                 data-action-method="POST"
                 data-confirm="Send update email?">Send Update Email</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
